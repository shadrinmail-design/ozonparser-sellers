# –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–∞ (Claude)

–¶–µ–ª—å: —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –¥–æ–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Ozon ¬´–¢–æ–≤–∞—Ä—ã –∏–∑ –ö–∏—Ç–∞—è¬ª, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–∫–ª—é—á–∞—è –æ—Ç–∑—ã–≤—ã/—Ä–µ–π—Ç–∏–Ω–≥/–¥–æ—Å—Ç–∞–≤–∫—É), –≤–µ—Å—Ç–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `max.gogocrm.ru/ozon` —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∑—ã–≤–æ–≤.

–°–¥–µ–ª–∞–Ω–æ:
- Python‚Äë–ø–∞—Ä—Å–µ—Ä (composer API) —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –¥–µ—Ç–∞–ª—è–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ —Ä–µ–∂–∏–º–æ–º –º–µ—Ç—Ä–∏–∫ (`src/ozon_parser/`).
- MongoDB‚Äë—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏; –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.
- –í–µ–±‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Flask) —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, health, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Nginx –Ω–∞ `/ozon`.
- Puppeteer‚Äë—Å–∫—Ä–∞–ø–µ—Ä (–∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç) —Å `puppeteer-extra-plugin-stealth`, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SOCKS/HTTPS –ø—Ä–æ–∫—Å–∏ –∏ –∫—É–∫, fallback‚ÄëDOM.
- –°–±–æ—Ä—â–∏–∫ –∫—É–∫ Playwright –∏ —á—Ç–µ–Ω–∏–µ –∫—É–∫ –∏–∑ —Ñ–∞–π–ª–∞/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ/–ø—Ä–æ–±–ª–µ–º—ã:
- Ozon –æ—Ç–≤–µ—á–∞–µ—Ç 403/–ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ ¬´–∂–∏–≤—ã—Ö¬ª –∫—É–∫/—Ä–µ–∑–∏–¥–µ–Ω—Ç–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞: `OZON_COOKIES`, `ALL_PROXY`/`SOCKS_PROXY`.
- Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω: `/ozon/` ‚Üí gunicorn 127.0.0.1:5007; —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/ozon/health` –¥–æ—Å—Ç—É–ø–Ω–∞.
- **–ë–õ–û–ö–ò–†–û–í–ö–ê OZON:** –¢–µ–∫—É—â–∏–π IP —Å–µ—Ä–≤–µ—Ä–∞ (157.180.78.70) –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Ozon ("–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω").
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ —Ç–∞–∫–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:
  - 89.208.145.18 (SSH SOCKS) - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Ozon (–∏–Ω—Ü–∏–¥–µ–Ω—Ç: fab_chlg_20251031192015_01K8XVD7NCTZ1Y1Q1K7ST3M0TM)
  - 95.181.175.97:40628 (HTTP –õ–æ–Ω–¥–æ–Ω, Hutchison UK) - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω IP 92.40.176.181)
  - 10 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ - –≤—Å–µ –º–µ—Ä—Ç–≤—ã–µ (ERR_TUNNEL_CONNECTION_FAILED –∏–ª–∏ timeout)
- Puppeteer-—Å–∫—Ä–∞–ø–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å stealth plugin, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ IP-–±–ª–æ–∫–∏—Ä–æ–≤–∫—É.
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ IP, –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö fingerprints (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç–µ—Å—Ç–∞–º–∏ curl –∏ Puppeteer).

–ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å (–±—ã—Å—Ç—Ä–æ):
- Python dry‚Äërun: `PYTHONPATH=src python -m ozon_parser --dry-run --max-pages 2`
- Python —Å –∑–∞–ø–∏—Å—å—é –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏: `PYTHONPATH=src python -m ozon_parser --metrics --mongo-uri ...`
- Puppeteer dry‚Äërun (3 –ø—Ä–æ–∫—Ä—É—Ç–∫–∏): `cd js && OZON_START_URL="/highlight/tovary-iz-kitaya-935133/?from_global=true" MAX_SCROLLS=3 DRY_RUN=1 node src/index.js`
- –ü—Ä–æ–∫—Å–∏: `ALL_PROXY=socks5://127.0.0.1:1080` (–∏–ª–∏ `HTTPS_PROXY=...`)
- –ö—É–∫–∏: `OZON_COOKIES='k=v; ...'`

–í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- –û–±—â–∏–µ: `OZON_START_URL` (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–∏—Å—Ç–∏–Ω–≥–∞).
- Mongo: `MONGODB_URI`, `MONGO_DB`, `MONGO_COLLECTION`, `MONGO_METRICS_COLLECTION`.
- –ü—Ä–æ–∫—Å–∏: `ALL_PROXY`/`SOCKS_PROXY`/`HTTPS_PROXY`/`HTTP_PROXY`.
- –ö—É–∫–∏: `OZON_COOKIES` –∏–ª–∏ `OZON_COOKIES_FILE`.

–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
**2025-11-01: –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏**
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∞—Å—Å–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∫—Å–∏ (`test_all_proxies.js`):
  - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ 1989 –ø—Ä–æ–∫—Å–∏ –∏–∑ —Ñ–∞–π–ª–∞ `proxy.js`
  - –ù–∞–π–¥–µ–Ω–æ 78 —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–∫—Å–∏ (3.92%)
  - –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π: 173.249.48.227:3128 (367ms)
  - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `proxy_test_results.json` –∏ `working_proxies.json`

- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ Puppeteer (`js/test_ozon_puppeteer.js`):
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–∫—Å–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ozon —Å –±—Ä–∞—É–∑–µ—Ä–æ–º
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ puppeteer-extra-plugin-stealth –¥–ª—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ç–∞
  - –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–∏ –æ–¥–∏–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ Ozon
  - –ü—Ä–∏—á–∏–Ω—ã: ERR_CERT_AUTHORITY_INVALID, ERR_TUNNEL_CONNECTION_FAILED, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP

- –í—ã–≤–æ–¥: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –ù–ï –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Ozon
  - –ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ IP
  - –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
  - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –†–æ—Å—Å–∏–∏

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1) **–ö–†–ò–¢–ò–ß–ù–û:** –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã–π —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏ (–Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Ozon). –ë–µ–∑ —ç—Ç–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.
   - –í–∞—Ä–∏–∞–Ω—Ç—ã: Brightdata residential, Oxylabs residential, Smartproxy residential
   - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ: IP –∏–∑ –†–æ—Å—Å–∏–∏, HTTP/HTTPS –∏–ª–∏ SOCKS5 –ø—Ä–æ–∫—Å–∏
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Mobile –ø—Ä–æ–∫—Å–∏ —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ IP
2) –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ–∫—Å–∏: –ø—Ä–æ–≥–æ–Ω Puppeteer —Å `SOCKS_PROXY` –∏–ª–∏ `HTTPS_PROXY`
3) –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≥–æ–Ω–∫–∞ –ø–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (MAX_SCROLLS —É–≤–µ–ª–∏—á–∏—Ç—å), –∑–∞–ø–∏—Å—å –≤ Mongo, –≤–∫–ª—é—á–∏—Ç—å `METRICS`.
4) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–± –Ω–∞ `max.gogocrm.ru/ozon/?sort=reviews` (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∑—ã–≤–æ–≤).
5) (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–≥—Ä—É–∑–∫—É —Ç–µ–∫—Å—Ç–æ–≤ –æ—Ç–∑—ã–≤–æ–≤ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É/—Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–æ—Å—Ç–∞–≤–∫–µ.

**–ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ–∫—Å–∏:**
```bash
# –° SOCKS –ø—Ä–æ–∫—Å–∏
cd /home/ozon-parser/js
PUPPETEER_EXECUTABLE_PATH=/usr/bin/google-chrome SOCKS_PROXY=socks5://your-proxy:port OZON_COOKIES="$(cat /home/ozon-parser/ozon_cookies_converted.txt)" MAX_SCROLLS=50 node src/index.js

# –ò–ª–∏ —Å HTTP –ø—Ä–æ–∫—Å–∏
PUPPETEER_EXECUTABLE_PATH=/usr/bin/google-chrome HTTPS_PROXY=http://your-proxy:port OZON_COOKIES="$(cat /home/ozon-parser/ozon_cookies_converted.txt)" MAX_SCROLLS=50 node src/index.js
```

---

## üöÄ MongoDB API –≥–æ—Ç–æ–≤–æ! (2025-11-01)

### API Endpoints

–í—Å–µ API –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ 

**1. GET /api/health** - Health check
```json
{
  "success": true,
  "status": "ok",
  "timestamp": "2025-11-01T04:02:13.434748"
}
```

**2. GET /api/stats** - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã
```json
{
  "success": true,
  "data": {
    "total_products": 0,
    "avg_rating": 0,
    "total_reviews": 0,
    "unique_brands": 0,
    "top_brands": []
  }
}
```

**3. GET /api/products** - –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `q` - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `brand` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –±—Ä–µ–Ω–¥—É
- `min_rating` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
- `sort` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (updated, rating, reviews, name)
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (default: 1)
- `per_page` - —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (default: 20, max: 100)

```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "per_page": 20,
    "total": 0,
    "pages": 0
  },
  "filters": {...}
}
```

**4. GET /api/products/<id>** - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä
```json
{
  "success": true,
  "data": {
    "ozon_id": 123456,
    "name": "...",
    "price_text": "...",
    "rating_value": 4.5,
    "reviews_count": 100,
    ...
  }
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# Health check
curl https://max.gogocrm.ru/ozon/api/health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl https://max.gogocrm.ru/ozon/api/stats

# –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
curl "https://max.gogocrm.ru/ozon/api/products?page=1&per_page=20"

# –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
curl "https://max.gogocrm.ru/ozon/api/products?q=phone"

# –§–∏–ª—å—Ç—Ä –ø–æ –±—Ä–µ–Ω–¥—É –∏ —Ä–µ–π—Ç–∏–Ω–≥—É
curl "https://max.gogocrm.ru/ozon/api/products?brand=Apple&min_rating=4.5"

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç–∑—ã–≤–∞–º
curl "https://max.gogocrm.ru/ozon/api/products?sort=reviews"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä
curl https://max.gogocrm.ru/ozon/api/products/123456
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–°–µ—Ä–≤–µ—Ä:** gunicorn –Ω–∞ 127.0.0.1:5007 (2 workers)
- **Nginx:** reverse proxy –Ω–∞ max.gogocrm.ru/ozon
- **MongoDB:** mongodb://localhost:27017/ozon
- **–ö–æ–ª–ª–µ–∫—Ü–∏—è:** products
- **–ë—ç–∫–∞–ø:** /home/ozon-parser/src/ozon_parser/web/app.py.backup

### –§–∞–π–ª—ã

- API routes: `/home/ozon-parser/src/ozon_parser/web/api_routes.py`
- Main app: `/home/ozon-parser/src/ozon_parser/web/app.py`
- WSGI: `/home/ozon-parser/src/ozon_parser/web/wsgi.py`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (2025-11-01)

**–î–∞—Ç–∞:** 2025-11-01
**–ú–∞—à–∏–Ω–∞:** macOS Darwin 23.6.0 (mikhailzhirnov@vitamobile)
**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** /Users/mikhailzhirnov/claude/ozonparser

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   - –£—Å–ø–µ—à–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –∏–∑ git@github.com:mzhirnov1/ozonparser.git (—á–µ—Ä–µ–∑ HTTPS)
   - –í—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ

2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   - Python 3.9.6 (—Ç—Ä–µ–±—É–µ—Ç—Å—è 3.10+, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
   - Python –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: requests, pymongo, tenacity, flask, playwright
   - Node.js v24.10.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - npm –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (puppeteer, stealth plugin) - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –∏–∑-–∑–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
   - Python –ø–∞—Ä—Å–µ—Ä: src/ozon_parser/ (client.py, storage.py, main.py, utils.py)
   - JavaScript/Puppeteer: js/src/index.js
   - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: src/ozon_parser/web/app.py
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: README.md, DEPLOY.md, AGENTS.md

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ó–∞–ø—É—â–µ–Ω dry-run —Ç–µ—Å—Ç: `PYTHONPATH=src python3 -m ozon_parser --dry-run --max-pages 2`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç 403 Forbidden –æ—Ç Ozon
   - –ü—Ä–∏—á–∏–Ω–∞: –∞–Ω—Ç–∏–±–æ—Ç –∑–∞—â–∏—Ç–∞ Ozon, —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–æ–∫—Å–∏ –∏ cookies
   - MongoDB –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª—Å—è –¥–ª—è dry-run)

5. **–í—ã–≤–æ–¥—ã:**
   - –ü–∞—Ä—Å–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Ozon
   - –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã: —Ä–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–∫—Å–∏ + –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ cookies
   - –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º (tenacity)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

- Composer API endpoint: `https://www.ozon.ru/api/composer-api.bx/page/json/v2`
- –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `/highlight/tovary-iz-kitaya-935133/?from_global=true`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏: HTTP_PROXY, HTTPS_PROXY, SOCKS_PROXY (Puppeteer)
- –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã: –æ–±—ã—á–Ω—ã–π, dry-run, –º–µ—Ç—Ä–∏–∫–∏
- Batch upsert –≤ MongoDB: 100 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ —Ä–∞–∑

### –¢–µ—Å—Ç Puppeteer —Å–∫—Ä–∞–ø–µ—Ä–∞ (–∞–Ω—Ç–∏–¥–µ—Ç–µ–∫—Ç):

**–ö–æ–º–∞–Ω–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
cd js
OZON_START_URL="/highlight/tovary-iz-kitaya-935133/?from_global=true" MAX_SCROLLS=3 DRY_RUN=1 node src/index.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
   - Chrome 131.0.6778.204 —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è Puppeteer
   - –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (puppeteer-extra, stealth-plugin) —Ä–∞–±–æ—Ç–∞—é—Ç

2. **–†–∞–±–æ—Ç–∞ —Å–∫—Ä–∞–ø–µ—Ä–∞:**
   - Stealth plugin –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (puppeteer.use(StealthPlugin()))
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç page.evaluate –¥–ª—è fetch –∫ Composer API (–æ–±—Ö–æ–¥ CORS)
   - User-Agent: —Ä–∞–Ω–¥–æ–º–Ω—ã–π –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π
   - Timezone: Europe/Moscow
   - Accept-Language: ru-RU
   - Viewport: —Ä–∞–Ω–¥–æ–º–Ω—ã–π (1280-1440 x 800-960)

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
   - Composer API: 403 Forbidden (HTTP 403)
   - Fallback –Ω–∞ DOM extraction: –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
   - Ozon –≤–µ—Ä–Ω—É–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω"
   - –ò–Ω—Ü–∏–¥–µ–Ω—Ç: `fab_chlg_20251101033922_01K8YQZ4PWQJ9DBXCXGDHAXHTQ`
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π IP: `85.107.106.36` (—Ç–µ–∫—É—â–∏–π IP)
   - –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 0

4. **–í—ã–≤–æ–¥—ã:**
   - ‚úÖ Puppeteer —Å–∫—Ä–∞–ø–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ Stealth plugin —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
   - ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç (API ‚Üí DOM)
   - ‚úÖ Screenshot –∏ HTML —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - ‚ùå –ë–µ–∑ –ø—Ä–æ–∫—Å–∏ IP –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è Ozon –¥–∞–∂–µ —Å–æ stealth plugin
   - ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ IP, –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ fingerprints

**–í—ã–≤–æ–¥:** Stealth plugin —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ –æ–±—Ö–æ–¥–∏—Ç IP-–±–ª–æ–∫–∏—Ä–æ–≤–∫—É Ozon. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Ä–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–∫—Å–∏.

---

## üéâ –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û! (2025-11-01)

### –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–ï–ó –ø—Ä–æ–∫—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** Ozon –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –¥–∞–∂–µ —Å–æ stealth plugin –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∑–∞–ø—Ä–æ—Å—ã.

**–ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–µ–∫—Ç–∞:**
- `navigator.webdriver = true` - –≥–ª–∞–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- `chrome.runtime = false` - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Puppeteer
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö cookies –∏ —Å–µ—Å—Å–∏–∏

**–†–ê–ë–û–ß–ï–ï –†–ï–®–ï–ù–ò–ï:**

1. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É–∫ –∏–∑ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ Chrome –ø—Ä–æ—Ñ–∏–ª—è:**
   ```bash
   cd js
   node copy_chrome_cookies.js  # –ö–æ–ø–∏—Ä—É–µ—Ç –∫—É–∫–∏ –∏–∑ Profile 5
   node test_real_chrome.js      # –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å –∫—É–∫–∞–º–∏
   ```

2. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ HTTP 200 OK
   - ‚úÖ 54 —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ
   - ‚úÖ –ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω"
   - ‚úÖ –ë–ï–ó –ü–†–û–ö–°–ò!

3. **–ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Puppeteer:**
   ```javascript
   puppeteer.launch({
     headless: false,
     userDataDir: '/tmp/chrome-puppeteer-profile', // —Å –∫—É–∫–∞–º–∏
     args: [
       '--disable-blink-features=AutomationControlled',
       '--disable-features=IsolateOrigins,site-per-process',
       '--lang=ru-RU',
     ],
     ignoreDefaultArgs: ['--enable-automation'],
   })
   ```

4. **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
   - –ö–æ–ø–∏—Ä—É–µ—Ç Cookies, Local Storage, Session Storage –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç Chrome —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –º–∞—Å–∫–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
   - Ozon –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä** (js/src/index.js)
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–∫** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—É—Å–∫–æ–º
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–±–æ—Ä** —Å MAX_SCROLLS=100
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Composer API** —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

---

## ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –†–ê–ë–û–¢–ê–ï–¢! (2025-11-01, –≤–µ—á–µ—Ä)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Safari + AppleScript + Cmd+V:

**–§–∞–π–ª:** `js/ozon_image_search.applescript` (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –û—Ç–∫—Ä—ã—Ç—å ozon.ru –≤ Safari
2. –ö–ª–∏–∫–Ω—É—Ç—å –∫–Ω–æ–ø–∫—É –∫–∞–º–µ—Ä—ã (`button.rn6_29`)
3. –°—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ—è–≤–∏–≤—à–µ–µ—Å—è –ø–æ–ª–µ –≤–≤–æ–¥–∞
4. **–í—Å—Ç–∞–≤–∏—Ç—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Cmd+V** (–±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞)
5. –ü–æ–¥–æ–∂–¥–∞—Ç—å 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ URL
6. –ù–∞–π—Ç–∏ –∏ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–π—Ç–∏"
7. –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (10 —Å–µ–∫)
8. –°–ø–∞—Ä—Å–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ `div[data-index]`

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ 25 —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
- ‚úÖ ID —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (regex: `/product\/[^\/]*-(\d+)/`)
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- ‚úÖ URL –ø–æ–ª–Ω—ã–µ –∏ —Ä–∞–±–æ—á–∏–µ
- ‚úÖ JSON —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

**–ó–∞–ø—É—Å–∫:**
```bash
cd /Users/mikhailzhirnov/claude/ozonparser/js

# –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ AppleScript
osascript ozon_image_search.applescript "https://ir.ozone.ru/s3/multimedia-1-5/wc600/7249026173.jpg"

# –ß–µ—Ä–µ–∑ Node.js wrapper
node image_search.js "https://ir.ozone.ru/s3/multimedia-1-5/wc600/7249026173.jpg"

# HTTP API —Å–µ—Ä–≤–µ—Ä
node image_search_server.js
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:3001
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Safari (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):**
```bash
defaults write com.apple.Safari AllowJavaScriptFromAppleEvents -bool true
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```json
{
  "success": true,
  "total_count": 25,
  "click_result": "OK: Found and clicked search button",
  "products": [
    {
      "index": 1,
      "id": "1176348271",
      "title": "–¢—É—à—å –¥–ª—è —Ä–µ—Å–Ω–∏—Ü...",
      "url": "https://www.ozon.ru/product/..."
    }
  ]
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢, –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

---

## üìä –ú–∞—Å—Å–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ (2025-11-01, –≤–µ—á–µ—Ä)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:

**1. `js/bulk_image_search.js`** - –ú–∞—Å—Å–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ JSON –∏–ª–∏ MongoDB
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

**2. `js/save_to_mongodb.js`** - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ MongoDB
- –ö–æ–ª–ª–µ–∫—Ü–∏—è: `image_search_results`
- Upsert –ø–æ `source_product.id` (–∏–∑–±–µ–∂–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**3. `js/products_test.json`** - –¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä (3 —Ç–æ–≤–∞—Ä–∞)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
cd /Users/mikhailzhirnov/claude/ozonparser/js

# –¢–µ—Å—Ç –Ω–∞ 1 —Ç–æ–≤–∞—Ä–µ
PRODUCTS_FILE=products_test.json LIMIT=1 node bulk_image_search.js

# –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫
mongoexport --uri="mongodb://..." --collection=products --out=products.json
PRODUCTS_FILE=products.json node bulk_image_search.js

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MongoDB
MONGODB_URI="mongodb://..." node save_to_mongodb.js
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ 1 —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∑–∞ 22.4 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ 25 –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ JSON –∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è MongoDB
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ~3-6 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö MongoDB:

```javascript
{
  source_product: {
    id: "7249026173",
    title: "–ú–∞—Å—Å–∞–∂–µ—Ä –¥–ª—è –≥–ª–∞–∑...",
    image: "https://ir.ozone.ru/...",
    price: 1990,
    url: "..."
  },
  search_result: {
    success: true,
    total_count: 25,
    products: [
      { id, title, url }
    ]
  },
  searched_at: ISODate("..."),
  updated_at: ISODate("...")
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º:

**–°–µ—Ä–≤–µ—Ä:** `ssh -p 2209 root@max.gogocrm.ru`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É "–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã" —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º (JOIN —Å `image_search_results`)
2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ `/ozon/product/<id>` —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ö–æ–∂–µ–≥–æ: —Ü–µ–Ω–∞, —Ä–µ–π—Ç–∏–Ω–≥, –æ—Ç–∑—ã–≤—ã, –¥–æ—Å—Ç–∞–≤–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `js/WEB_INTEGRATION.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É `ssh -p 2209 root@max.gogocrm.ru`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ MongoDB –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∞—Å—Å–æ–≤—ã–π –ø–æ–∏—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Mac, —Ç.–∫. —Ç—Ä–µ–±—É–µ—Ç—Å—è Safari)
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ MongoDB –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
6. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–≥–ª–∞—Å–Ω–æ `WEB_INTEGRATION.md`

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:**
- 100 —Ç–æ–≤–∞—Ä–æ–≤: ~20-30 –º–∏–Ω—É—Ç
- 1000 —Ç–æ–≤–∞—Ä–æ–≤: ~3-5 —á–∞—Å–æ–≤
- 10000 —Ç–æ–≤–∞—Ä–æ–≤: ~30-50 —á–∞—Å–æ–≤ (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–æ—á—å—é)

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ URL –≤ –ø–æ–∏—Å–∫ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (2025-11-01, –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä)

### –ü—Ä–æ–±–ª–µ–º–∞:
URL –Ω–µ –≤—Å—Ç–∞–≤–ª—è–ª—Å—è –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –∫–∞–º–µ—Ä—ã.

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (debug_paste_issue.applescript):

**–ù–∞–π–¥–µ–Ω–æ 3 input –ø–æ–ª—è:**
1. `input[0]` - –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ (placeholder: "–ò—Å–∫–∞—Ç—å –Ω–∞ Ozon", class: "ns2_29")
2. `input[1]` - –°–∫—Ä—ã—Ç–æ–µ file input (type="file", –Ω–µ –≤–∏–¥–∏–º–æ)
3. `input[2]` - **–ü–æ–ª–µ –¥–ª—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (type="text", class: "c15_5_1-a8", visible: true)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤—Å—Ç–∞–≤–∫–∏:

**1. Cmd+V (System Events keystroke):**
```applescript
set the clipboard to imageURL
tell application "System Events"
    keystroke "a" using command down
    keystroke "v" using command down
end tell
```
- ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢!** (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 30 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
- –í–ê–ñ–ù–û: —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ input –ø–æ–ª–µ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π

**2. JavaScript setValue (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞):**
```javascript
targetInput.value = 'URL';
targetInput.dispatchEvent(new Event('input', { bubbles: true }));
```
- ‚ö†Ô∏è –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø - –º–æ–∂–µ—Ç –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é Ozon
- Ozon –∏—Å–ø–æ–ª—å–∑—É–µ—Ç React –∏ –æ–∂–∏–¥–∞–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è

### –í—ã–≤–æ–¥:
**Cmd+V —è–≤–ª—è–µ—Ç—Å—è –†–ê–ë–û–ß–ò–ú –∏ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ú –º–µ—Ç–æ–¥–æ–º –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ URL.**

### –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ozon_image_search.applescript` (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π) —Å Cmd+V
- –§–∞–π–ª: `js/ozon_image_search.applescript`
- –ú–µ—Ç–æ–¥: clipboard + System Events keystroke
- –°—Ç–∞—Ç—É—Å: –†–ê–ë–û–¢–ê–ï–¢ –°–¢–ê–ë–ò–õ–¨–ù–û

---

## ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ Puppeteer/Chrome (2025-11-01, –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä)

### –ü—Ä–æ–±–ª–µ–º–∞:
–ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (camera button, class `rn6_29`) **–ù–ï –î–û–°–¢–£–ü–ù–ê –≤ Chrome —á–µ—Ä–µ–∑ Puppeteer**.

### –ü—Ä–∏—á–∏–Ω–∞:
- Ozon –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **browser detection**
- –ö–Ω–æ–ø–∫–∞ –∫–∞–º–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤ Safari
- –í Chrome (–¥–∞–∂–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º) –∫–Ω–æ–ø–∫–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- **Puppeteer –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è Ozon** –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞:
  - puppeteer-extra-plugin-stealth
  - –†–µ–∞–ª—å–Ω—ã–π Chrome profile (Default, Profile 5)
  - --disable-blink-features=AutomationControlled
  - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É–∫

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```
Page title: "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω"
Camera buttons: [] (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
File inputs: [] (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
```

###–í—ã–≤–æ–¥:
‚ùå **Puppeteer –ù–ï –ü–û–î–•–û–î–ò–¢ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –Ω–∞ Ozon**
‚úÖ **Safari + AppleScript - –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ**

### –§–∞–π–ª—ã –ø–æ–ø—ã—Ç–æ–∫:
- `js/ozon_image_search_puppeteer.js` - –Ω–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
- `js/test_chrome_image_search.js` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Safari AppleScript –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º.

