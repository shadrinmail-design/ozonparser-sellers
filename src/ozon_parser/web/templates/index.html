{% extends 'layout.html' %}
{% block title %}–ö–∞—Ç–∞–ª–æ–≥{% endblock %}
{% block content %}

<form class="filters" method="get" action="{{ url_for('index') }}">
  <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –±—Ä–µ–Ω–¥—É, –ø—Ä–æ–¥–∞–≤—Ü—É" value="{{ q }}" />
  <input type="text" name="brand" placeholder="–ë—Ä–µ–Ω–¥" value="{{ brand }}" />
  <input type="number" step="0.1" min="0" max="5" name="min_rating" placeholder="–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥" value="{{ min_rating }}" />
  <select name="sort">
    <option value="updated" {% if sort=='updated' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ</option>
    <option value="rating" {% if sort=='rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
    <option value="reviews" {% if sort=='reviews' %}selected{% endif %}>–ü–æ –æ—Ç–∑—ã–≤–∞–º</option>
    <option value="name" {% if sort=='name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
  </select>
  <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
</form>

<div class="summary">–í—Å–µ–≥–æ: {{ total }} | –°—Ç—Ä. {{ page }} –∏–∑ {{ pages }}</div>
{% if error %}
<div class="summary" style="color:#f87171">–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {{ error }}</div>
{% endif %}

<div class="grid">
  {% for it in items %}
  <article class="card">
    <a class="thumb" href="{{ url_for('product', doc_id=it._id) }}">
      {% if it.thumb %}
        <img src="{{ it.thumb }}" alt="{{ it.name }}" />
      {% else %}
        <div class="noimg">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
      {% endif %}
    </a>
    <div class="body">
      <h3 class="title"><a href="{{ url_for('product', doc_id=it._id) }}">{{ it.name or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}</a></h3>
      <div class="meta">
        {% if it.brand %}<span class="brand">{{ it.brand }}</span>{% endif %}
        {% if it.rating_value %}<span class="rating">‚≠ê {{ '%.1f'|format(it.rating_value) }}</span>{% endif %}
        {% if it.reviews_count %}<span class="reviews">üí¨ {{ it.reviews_count }}</span>{% endif %}
      </div>
      {% if it.price_text %}<div class="price">{{ it.price_text }}</div>{% endif %}
      {% if it.url %}<div class="ext"><a href="{{ it.url }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Ozon</a></div>{% endif %}
    </div>
  </article>
  {% endfor %}
  {% if not items %}
  <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
  {% endif %}
  </div>

<div class="pagination">
  {% set prev_page = page - 1 %}
  {% set next_page = page + 1 %}
  {% if page > 1 %}
    <a class="btn" href="{{ url_for('index', q=q, brand=brand, min_rating=min_rating, sort=sort, page=prev_page) }}">‚Üê –ù–∞–∑–∞–¥</a>
  {% endif %}
  {% if page < pages %}
    <a class="btn" href="{{ url_for('index', q=q, brand=brand, min_rating=min_rating, sort=sort, page=next_page) }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
  {% endif %}
</div>

{% endblock %}
